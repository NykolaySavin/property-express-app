<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Jquery app</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
      crossorigin="anonymous"
    />
    <link href="/static/css/main.c31ba30b.chunk.css" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Property application</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="properties.html"
              >Properties <span class="sr-only">(current)</span></a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="properties.html">properties</a>
          </li>
        </ul>
      </div>
    </nav>
    <div id="editContainer">
      <p><b>Edit property</b></p>
      <table>
        <tr>
          <td><input type="hidden" id="editId" /></td>
          <td></td>
        </tr>
        <tr>
          <td>Street:</td>
          <td><input type="text" id="editStreet" /></td>
        </tr>
        <tr>
          <td>House number:</td>
          <td><input type="text" id="editHouseNumber" /></td>
        </tr>
        <tr>
          <td>Postcode:</td>
          <td><input type="text" id="editPostcode" /></td>
        </tr>
        <tr>
          <td>City:</td>
          <td><input type="text" id="editCity" /></td>
        </tr>
        <tr>
          <td>City district:</td>
          <td><input type="text" id="editDistrict" /></td>
        </tr>
        <tr>
          <td>Country:</td>
          <td><input type="text" id="editCountry" /></td>
        </tr>
        <tr>
          <td>Living area:</td>
          <td><input type="number" id="editLivingArea" /></td>
        </tr>
        <tr>
          <td>Building area:</td>
          <td><input type="number" id="editBuildingArea" /></td>
        </tr>
        <tr>
          <td>Year built:</td>
          <td><input type="number" id="editYearBuilt" /></td>
        </tr>
        <tr>
          <td>Year altered:</td>
          <td><input type="number" id="editYearAltered" /></td>
        </tr>
        <tr>
          <td>Bathrooms total:</td>
          <td><input type="number" id="editBathroomsTotal" /></td>
        </tr>
        <tr>
          <td>Bedrooms total:</td>
          <td><input type="number" id="editBedroomsTotal" /></td>
        </tr>
        <tr>
          <td>Owner Id:</td>
          <td><input type="text" id="editOwnerId" /></td>
        </tr>
      </table>

      <button id="editButton" class="button">Save</button>
    </div>

    <div id="createContainer">
      <p><b>Add property</b></p>
      <table>
        <tr>
          <td>Street:</td>
          <td><input type="text" id="createStreet" /></td>
        </tr>
        <tr>
          <td>House number:</td>
          <td><input type="text" id="createHouseNumber" /></td>
        </tr>
        <tr>
          <td>City:</td>
          <td><input type="text" id="createCity" /></td>
        </tr>
        <tr>
          <td>Postcode:</td>
          <td><input type="text" id="createPostcode" /></td>
        </tr>
        <tr>
          <td>City district:</td>
          <td><input type="text" id="createDistrict" /></td>
        </tr>
        <tr>
          <td>Country:</td>
          <td><input type="text" id="createCountry" /></td>
        </tr>
        <tr>
          <td>Living area:</td>
          <td><input type="number" id="createLivingArea" /></td>
        </tr>
        <tr>
          <td>Building area:</td>
          <td><input type="number" id="createBuildingArea" /></td>
        </tr>
        <tr>
          <td>Year built:</td>
          <td><input type="number" id="createYearBuilt" /></td>
        </tr>
        <tr>
          <td>Year altered:</td>
          <td><input type="number" id="createYearAltered" /></td>
        </tr>
        <tr>
          <td>Bathrooms total:</td>
          <td><input type="number" id="createBathroomsTotal" /></td>
        </tr>
        <tr>
          <td>Bedrooms total:</td>
          <td><input type="number" id="createBedroomsTotal" /></td>
        </tr>
        <tr>
          <td>Owner Id:</td>
          <td><input type="text" id="createOwnerId" /></td>
        </tr>
      </table>

      <button id="createButton" class="button">Save</button>
    </div>

    <div id="tableContainer"></div>
    <script
      src="https://code.jquery.com/jquery-3.4.1.js"
      integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
      integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
      integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript">
      $(document).ready(function() {
        getProperties();
        $("#editButton").click(function(event) {
          event.preventDefault();
          editProperty();
        });
        $("#createButton").click(function(event) {
          event.preventDefault();
          createProperty();
        });
      });
      function getProperties() {
        $("#createContainer").css("display", "block");
        $("#editContainer").css("display", "none");
        $.ajax({
          url: "/v1/properties",
          type: "GET",
          dataType: "json",
          success: function(data) {
            writeResponse(data);
          },
          error: function(x, y, z) {
            console.log("Error: " + x + "\n" + y + "\n" + z);
          }
        });
      }
      function createProperty() {
        var property = {
          address: {
            street: $("#createStreet").val(),
            country: $("#createCountry").val(),
            postcode: $("#createPostcode").val(),
            city: $("#createCity").val(),
            city_district: $("#createDistrict").val(),
            house_number: $("#createHouseNumber").val()
          },
          yearBuilt: +$("#createYearBuilt").val(),
          yearAltered: +$("#createYearAltered").val(),
          bathroomsTotal: +$("#createBathroomsTotal").val(),
          bedroomsTotal: +$("#createBedroomsTotal").val(),
          livingArea: +$("#createLivingArea").val(),
          buildingArea: +$("#createBuildingArea").val(),
          ownerId: $("#createOwnerId").val()
        };
        $.ajax({
          url: "/v1/properties",
          type: "POST",
          data: JSON.stringify(property),
          contentType: "application/json;charset=utf-8",
          success: function(data) {
            getProperties();
          },
          error: function(x, y, z) {
            console.log("Error: " + x + "\n" + y + "\n" + z);
          }
        });
      }
      function deleteProperty(id) {
        $.ajax({
          url: "/v1/properties/" + id,
          type: "DELETE",
          contentType: "application/json;charset=utf-8",
          success: function(data) {
            getProperties();
          },
          error: function(x, y, z) {
            console.log("Error: " + x + "\n" + y + "\n" + z);
          }
        });
      }
      function editProperty() {
        var id = $("#editId").val();
        var property = {
          id: $("#editId").val(),
          address: {
            street: $("#editStreet").val(),
            country: $("#editCountry").val(),
            postcode: $("#editPostcode").val(),
            city: $("#editCity").val(),
            city_district: $("#editDistrict").val(),
            house_number: $("#editHouseNumber").val()
          },
          yearBuilt: +$("#editYearBuilt").val(),
          yearAltered: +$("#editYearAltered").val(),
          bathroomsTotal: +$("#editBathroomsTotal").val(),
          bedroomsTotal: +$("#editBedroomsTotal").val(),
          livingArea: +$("#editLivingArea").val(),
          buildingArea: +$("#editBuildingArea").val(),
          ownerId: $("#editOwnerId").val()
        };
        $.ajax({
          url: "/v1/properties/" + id,
          type: "PUT",
          data: JSON.stringify(property),
          contentType: "application/json;charset=utf-8",
          success: function(data) {
            getProperties();
          },
          error: function(x, y, z) {
            console.log("Error: " + x + "\n" + y + "\n" + z);
          }
        });
      }
      function writeResponse(properties) {
        var strResult =
          "<table class='table' id='tableContainer'>" +
          "<tr>" +
          "<th>Id</th>" +
          "<th>Street</th>" +
          "<th>House number</th>" +
          "<th>City</th>" +
          "<th>City district</th>" +
          "<th>Country</th>" +
          "<th>Postcode</th>" +
          "<th>Year built</th>" +
          "<th>Year altered</th>" +
          "<th>Bathrooms total</th>" +
          "<th>Bedrooms total</th>" +
          "<th>Living area</th>" +
          "<th>Building area</th>" +
          "<th></th>" +
          "</tr>";
        $.each(properties, function(index, property) {
          strResult +=
            "<tr><td>" +
            property.id +
            "</td><td>" +
            property.address.street +
            "</td><td>" +
            property.address.house_number +
            "</td><td>" +
            property.address.city +
            "</td><td>" +
            property.address.city_district +
            "</td><td>" +
            property.address.country +
            "</td><td>" +
            property.address.postcode +
            "</td><td>" +
            property.yearBuilt +
            "</td><td>" +
            property.yearAltered +
            "</td><td>" +
            property.bathroomsTotal +
            "</td><td>" +
            property.bedroomsTotal +
            "</td><td>" +
            property.livingArea +
            "</td><td>" +
            property.buildingArea +
            "</td><td>" +
            property.ownerId +
            "</td><td>" +
            "<a class='c' id='editItem' data-item='" +
            property.id +
            "' onclick='editItem(this);' >Edit</a>" +
            " |  " +
            "<a class='c' id='delItem' data-item='" +
            property.id +
            "' onclick='deleteItem(this);' >Delete</a></td>";
          ("</tr>");
        });
        strResult += "</table>";
        $("#tableContainer").html(strResult);
      }
      function deleteItem(el) {
        var id = $(el).attr("data-item");
        deleteProperty(id);
      }
      function editItem(el) {
        var id = $(el).attr("data-item");
        getProperty(id);
      }
      function showProperty(property) {
        if (property != null) {
          $("#createContainer").css("display", "none");
          $("#editContainer").css("display", "block");
          $("#editId").val(property.id);
          $("#editStreet").val(property.address.street);
          $("#editHouseNumber").val(property.address.house_number);
          $("#editPostcode").val(property.address.postcode);
          $("#editCity").val(property.address.city);
          $("#editCountry").val(property.address.country);
          $("#editDistrict").val(property.address.city_district);
          $("#editYearAltered").val(property.yearAltered);
          $("#editYearBuilt").val(property.yearBuilt);
          $("#editBathroomsTotal").val(property.bathroomsTotal);
          $("#editBedroomsTotal").val(property.bedroomsTotal);
          $("#editLivingArea").val(property.livingArea);
          $("#editBuildingArea").val(property.buildingArea);
          $("#editOwnerId").val(property.ownerId);
        } else {
          console.log("This is no property");
        }
      }
      function getProperty(id) {
        $.ajax({
          url: "/v1/properties/" + id,
          type: "GET",
          dataType: "json",
          success: function(data) {
            showProperty(data);
          },
          error: function(x, y, z) {
            console.log("Error: " + x + "\n" + y + "\n" + z);
          }
        });
      }
    </script>
  </body>
</html>
